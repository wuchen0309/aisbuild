# aisbuild 一键部署指南

本项目提供了一套自动化脚本，适配 VPS 环境，支持通过 Docker 快速部署 aisbuild 服务。

## 📋 准备工作

1.  **环境要求**: 服务器需安装 Docker。
2.  **文件准备**: 确保目录包含以下文件：
    *   `deploy.sh` (部署脚本)
    *   `app.env` (配置文件)

---

## 🔐 认证配置（二选一）

请根据你的需求选择一种认证方式。**推荐 VPS 用户使用方式一。**

### 方式一：文件挂载认证（推荐）
这种方式管理账号更方便，支持自动持久化Session。

1.  在脚本同级目录下创建一个名为 `auth` 的文件夹：
    ```bash
    mkdir auth
    ```
2.  将你的认证 JSON 文件放入该目录中。
3.  **重要：** 文件名必须严格遵循以下格式：
    *   第一个账号：`auth-1.json`
    *   第二个账号：`auth-2.json`
    *   以此类推...

*注意：部署脚本会自动检测此目录，并修正权限挂载到容器中。*

### 方式二：环境变量认证
如果不方便创建文件，可以直接将认证内容填入 `app.env`：

1.  打开 `app.env`。
2.  找到 `# AUTH_JSON_1=`。
3.  **删除行首的 `#` 号**，并将 JSON 内容完整填入等号后面。

---

## ⚙️ 基础配置

编辑 `app.env` 文件，设置必要的服务参数：

```bash
nano app.env
```

| 配置项 | 说明 | 必填/选填 |
| :--- | :--- | :--- |
| `API_KEYS` | **(必填)** 设置连接此服务时使用的密码（SK） | ✅ |
| `SWITCH_ON_USES` | 单个账号使用多少次后自动切换（建议 <=50） | 选填 |
| `MAX_RETRIES` | 服务端内部重试次数（默认 1） | 选填 |
| `STREAMING_MODE` | 流式模式，推荐保持 `real` | 选填 |

---

## 🚀 启动部署

赋予脚本执行权限并运行：

```bash
chmod +x deploy.sh && ./deploy.sh
```

**脚本会自动执行以下操作：**
1.  检测是否存 `auth` 目录，若存在则自动设置权限并挂载。
2.  拉取最新镜像并重启容器。
3.  检测是否配置了代理（在脚本内配置）。
4.  **启动成功后，会自动显示服务器的公网 IP 和访问地址。**

---

## 🛠️ 高级与维护

### 1. 配置网络代理
如果服务器无法直接连接到谷歌，请编辑 `deploy.sh` 文件头部：
```bash
# 修改 PROXY_URL 变量
PROXY_URL="http://127.0.0.1:7890"
```

### 2. 修改服务端口
默认端口为 `7860`。如需修改，请编辑 `deploy.sh`：
```bash
HOST_PORT="8080" # 修改为你需要的端口
```

### 3. 常用命令
*   **查看日志**: `docker logs -f aisbuild`
*   **停止服务**: `docker stop aisbuild`
*   **更新服务**: 重新运行 `./deploy.sh` 即可。
